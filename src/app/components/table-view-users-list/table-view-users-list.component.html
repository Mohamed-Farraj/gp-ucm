<section>
  <div class="filteration container-fluid p-3">
    <div class="row justify-content-start">
      <!-- Search input -->
      <div class="col-12 col-sm-10 col-md-8 col-lg-4 mb-3">
        <input
          type="text"
          class="form-control rounded-pill"
          placeholder="ابحث بالاسم أو الرقم القومي"
          [formControl]="searchControl"
        />
      </div>

      <!-- Sort dropdown -->
      <div class="col-12 col-sm-10 col-md-8 col-lg-2 mb-3">
        <select class="form-select" [formControl]="sortControl">
          <option value="normal">الاقدم اولا</option>
          <option value="reverse">الاحدث اولا</option>
        </select>
      </div>

      <!-- Status checkboxes -->
      <div class="col-12 col-sm-10 col-md-8 col-lg-2 mb-3 text-center">
        <div
          class="btn-group d-inline-flex flex-no-wrap justify-content-center"
          role="group"
          aria-label="Basic checkbox toggle button group"
        >
          <!-- تحت المراجعة -->
          <input
            type="checkbox"
            value="UNDER_REVIEW"
            id="underReview"
            class="btn-check"
            (change)="onStatusChange($event)"
            autocomplete="off"
          />
          <label
            class="btn btn-outline-warning rounded-start-pill"
            for="underReview"
          >
            تحت المراجعة
          </label>

          <!-- مقبول -->
          <input
            type="checkbox"
            value="ACCEPTED"
            id="accepted"
            class="btn-check"
            (change)="onStatusChange($event)"
            autocomplete="off"
          />
          <label
            class="btn btn-outline-success rounded-0 border-end-0"
            for="accepted"
          >
            مقبول
          </label>

          <!-- مرفوض -->
          <input
            type="checkbox"
            value="REJECTED"
            id="rejected"
            class="btn-check"
            (change)="onStatusChange($event)"
            autocomplete="off"
          />
          <label class="btn btn-outline-danger rounded-end-pill" for="rejected">
            مرفوض
          </label>
        </div>
      </div>

      <!-- Gender checkboxes -->
      <div class="col-12 col-sm-10 col-md-8 col-lg-1 mb-3 text-center">
        <div
          class="btn-group d-inline-flex flex-no-wrap justify-content-center"
          role="group"
          aria-label="Gender filter buttons"
        >
          <!-- Male -->
          <input
            type="checkbox"
            value="MALE"
            id="male"
            class="btn-check"
            (change)="onGenderChange($event)"
            autocomplete="off"
          />
          <label class="btn btn-outline-primary rounded-start-pill" for="male">
            ذكر
          </label>

          <!-- Female -->
          <input
            type="checkbox"
            value="FEMALE"
            id="female"
            class="btn-check"
            (change)="onGenderChange($event)"
            autocomplete="off"
          />
          <label class="btn btn-outline-info rounded-end-pill" for="female">
            أنثى
          </label>
        </div>
      </div>

      <!-- download excel -->
      <div
        class="col-12 col-sm-10 col-md-8 col-lg-2 mb-3 text-center d-flex gap-3"
      >
        <button
          type="button"
          class="btn btn-outline-dark rounded-pill d-flex justify-content-center align-items-center gap-2 px-3"
          (click)="openDialog()"
        >
          <i class="fa-solid fa-download"></i>
          <span>تنزيل</span>
        </button>
        <button
          type="button"
          class="btn btn-outline-success rounded-pill d-flex justify-content-center align-items-center gap-2 px-3"
          (click)="openUploadDialog()"
        >
          <i class="fa-solid fa-upload"></i>
          <span>رفع</span>
        </button>
      </div>
    </div>
  </div>

  <h4 class="text-center">
    عدد الطلبات:
    {{
      searchControl.value || selectedStatuses.length > 0 || selectedGenders.length > 0
        ? filteredItems.length
        : res.length
    }}
  </h4>

  <table
    class="table m-auto table-hover table-striped border border-3 rounded rounded-3 shadow-lg"
  >
    <thead class="">
      <tr class="">
        <th scope="col">الحالة</th>
        <th scope="col">الرقم القومي</th>
        <th scope="col">الاسم</th>
        <th scope="col">الموبايل</th>
        <th scope="col">العنوان</th>
        <th scope="col">الكلية</th>
        <th scope="col">الفرقة</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody class="">
      @for (item of pagedItems; track $index) {
      <tr (click)="RowClick(item)" class="cursor-pointer">
        <td>
          <i
            [class.text-success]="item?.status === 'ACCEPTED'"
            [class.text-danger]="item?.status === 'REJECTED'"
            [class.text-warning]="item?.status === 'UNDER_REVIEW'"
            class="fa-solid fa-circle mx-2"
          ></i>
        </td>
        <th scope="row">{{ item?.nationalId }}</th>
        <td>{{ item?.firstName }} {{ item?.lastName }}</td>
        <td>{{ item?.mobileNumber }}</td>
        <td>{{ item?.residenceAddress }}</td>
        <td>{{ item?.faculty }}</td>
        <td>{{ item?.level }}</td>
        <td>
          <button
            (click)="$event.stopPropagation()"
            class="rejectButton px-4 btn btn-outline-danger"
          >
            <i class="fa-solid fa-trash me-2"></i>
            حذف الطلب
          </button>
          <!-- <div class="buttons d-flex gap-3">
            <button [class.d-none]="item?.status === 'ACCEPTED'"     (click)="DecideAr(item?.userId,'ACCEPTED',item);$event.stopPropagation()" class="acceptButton px-4 btn btn-outline-success">قبول الطلب</button>
            <button [class.d-none]="item?.status === 'REJECTED'"     (click)="DecideAr(item?.userId,'REJECTED',item);$event.stopPropagation()" class="rejectButton px-4 btn btn-outline-danger">رفض الطلب</button>
            <button [class.d-none]="item?.status === 'UNDER_REVIEW'" (click)="DecideAr(item?.userId,'UNDER_REVIEW',item);$event.stopPropagation()" class="reviewButton px-3 btn btn-outline-warning">تحت المراجعة</button>
        </div> -->
        </td>
      </tr>
      }
    </tbody>
  </table>

  <!-- <button class="btn btn-primary mx-auto" (click)="downloadFile()">
    download excel
  </button> -->

  <nav dir="rtl" class="py-3" aria-label="Page navigation ">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a
          class="cursor-pointer page-link rounded-start-pill rounded"
          (click)="changePage(currentPage - 1)"
        >
          السابق
        </a>
      </li>
      <li
        class="page-item"
        *ngFor="let page of getDisplayedPages()"
        [class.active]="page === currentPage"
      >
        <a class="cursor-pointer page-link" (click)="changePage(page)">{{
          page
        }}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a
          class="cursor-pointer page-link rounded-end-pill rounded"
          (click)="changePage(currentPage + 1)"
        >
          التالي
        </a>
      </li>
    </ul>
  </nav>
</section>
