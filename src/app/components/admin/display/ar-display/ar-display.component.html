<div class="container-fluid py-4" dir="rtl">
  @if (applicationRequest) {
  <section class="row">
    <section class="col-md-12">
      <div class="card shadow-lg border-0">
        <div class="card-header py-3 text-white position-relative" style="background: linear-gradient(130deg, #191727, #202f52);
    color: white; border: 1px solid rgba(255, 255, 255, 0.18);">
          <div class="position-absolute top-0 start-0 w-100 h-100" style="background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.2), transparent 70%); z-index: 0; border-radius: 15px;"></div>
          <h3 class="text-center d-flex justify-content-center mb-0 position-relative" style="text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); z-index: 1;">
            <span style="font-weight: 600;">عرض بيانات الطلب</span>
            
            <!-- Under Review Badge -->
            <span *ngIf="applicationRequest?.status === 'UNDER_REVIEW'" 
                  class="badge ms-2" 
                  style="background: linear-gradient(135deg, #f39c12, #e67e22); 
                         padding: 8px 15px; 
                         border-radius: 20px;
                         box-shadow: 0 4px 10px rgba(230, 126, 34, 0.4);
                         position: relative;
                         overflow: hidden;">
              <span class="position-absolute top-0 start-0 w-100 h-100" 
                    style="background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.4), transparent); 
                           z-index: 0;"></span>
              <span style="position: relative; z-index: 1;">تحت المراجعة</span>
            </span>
            
            <!-- Accepted Badge -->
            <span *ngIf="applicationRequest?.status === 'ACCEPTED'" 
                  class="badge ms-2" 
                  style="background: linear-gradient(135deg, #2ecc71, #27ae60); 
                         padding: 8px 15px; 
                         border-radius: 20px;
                         box-shadow: 0 4px 10px rgba(46, 204, 113, 0.4);
                         position: relative;
                         overflow: hidden;">
              <span class="position-absolute top-0 start-0 w-100 h-100" 
                    style="background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.4), transparent); 
                           z-index: 0;"></span>
              <span style="position: relative; z-index: 1;">مقبول</span>
            </span>
            
            <!-- Rejected Badge -->
            <span *ngIf="applicationRequest?.status === 'REJECTED'" 
                  class="badge ms-2" 
                  style="background: linear-gradient(135deg, #e74c3c, #c0392b); 
                         padding: 8px 15px; 
                         border-radius: 20px;
                         box-shadow: 0 4px 10px rgba(231, 76, 60, 0.4);
                         position: relative;
                         overflow: hidden;">
              <span class="position-absolute top-0 start-0 w-100 h-100" 
                    style="background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.4), transparent); 
                           z-index: 0;"></span>
              <span style="position: relative; z-index: 1;">مرفوض</span>
            </span>
          </h3>
        </div>

        <div class="card-body p-4">
          <!-- بيانات الطالب الشخصية -->
          <div class="section-container mb-4">
            <h4 class="section-title border-bottom pb-2 mb-3">البيانات الشخصية</h4>
            
            <!-- صف: معرف المستخدم -->
            <!-- <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">معرف المستخدم</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.userId }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">كود الطالب</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.studentCode }}</p>
              </div>
            </div> -->
            
            <!-- صف: الرقم القومي ورقم جواز السفر -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">الرقم القومي</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.nationalId }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">رقم جواز السفر</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.passportNumber || 'غير متوفر' }}</p>
              </div>
            </div>
            
            <!-- صف: جهة إصدار جواز السفر -->
            <div class="mb-4 row" *ngIf="applicationRequest?.passportIssuingAuthority">
              <label class="col-sm-2 col-form-label fw-bold">جهة إصدار جواز السفر</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.passportIssuingAuthority || 'غير متوفر' }}</p>
              </div>
            </div>
            
            <!-- صف: الاسم الأول والاسم الثاني -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">الاسم الأول</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.firstName }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">الاسم الثاني</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.lastName }}</p>
              </div>
            </div>
            
            <!-- صف: تاريخ الميلاد ومحّل الميلاد -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">تاريخ الميلاد</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.dateOfBirth}}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">محل الميلاد</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.placeOfBirth }}</p>
              </div>
            </div>
            
            <!-- صف: النوع والديانة -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">النوع</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.gender === 'MALE' ? 'ذكر' : 'أنثى' }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">الديانة</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.religion === 'MUSLIM' ? 'مسلم' : 'مسيحي' }}</p>
              </div>
            </div>
            
            <!-- معلومات الاتصال والعنوان -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">محل الإقامة</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.residenceAddress }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">الموبايل</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.mobileNumber }}</p>
              </div>
            </div>
            
            <!-- صف: العنوان بالتفصيل -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">العنوان بالتفصيل</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.detailedAddress }}</p>
              </div>
            </div>
            
            <!-- صف: البريد الالكتروني -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">البريد الإلكتروني</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.username }}</p>
              </div>
            </div>
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">ملف الطالب</label>
              <div class="col-sm-10">
            <button
            type="button"
            class="btn btn-outline-dark flex-fill d-flex justify-content-center align-items-center gap-2"
            (click)="downloadMedia()"
          >
            <i class="fa-solid fa-download"></i>
            <span>تنزيل</span>
          </button> 
            </div>
            </div>
          </div>
          
          <!-- بيانات الجامعة -->
          <div class="section-container mb-4">
            <h4 class="section-title border-bottom pb-2 mb-3">البيانات الجامعية</h4>
            
            <!-- صف: الجامعة -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">الجامعة</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.university?.name }}</p>
              </div>
            </div>
            
            <!-- صف: الكلية والفرقة -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">الكلية</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.faculty }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">الفرقة</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.level }}</p>
              </div>
            </div>
            
            <!-- صف: عدد العقوبات -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">عدد العقوبات</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.penaltiesCount }}</p>
              </div>
            </div>
            
            <!-- صف: نوع الطالب -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">نوع الطالب</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.studentType || 'غير محدد' }}</p>
              </div>
            </div>
          </div>
          
          <!-- بيانات السكن -->
          <div class="section-container mb-4">
            <h4 class="section-title border-bottom pb-2 mb-3">بيانات السكن</h4>
            <div *ngIf="applicationRequest?.room">
              <!-- صف: معلومات الغرفة -->
              <div class="mb-4 row">
                <label class="col-sm-2 col-form-label fw-bold">رقم الغرفة</label>
                <div class="col-sm-4">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.room?.roomNumber }}</p>
                </div>
                <label class="col-sm-2 col-form-label fw-bold">السعة</label>
                <div class="col-sm-4">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.room?.currentOccupancy }} / {{ applicationRequest?.room?.capacity }}</p>
                </div>
              </div>
              
              <!-- صف: معلومات المبنى -->
              <div class="mb-4 row">
                <label class="col-sm-2 col-form-label fw-bold">المبنى</label>
                <div class="col-sm-4">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.room?.building?.name }}</p>
                </div>
                <label class="col-sm-2 col-form-label fw-bold">نوع المبنى</label>
                <div class="col-sm-4">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.room?.building?.type === 'MALE' ? 'طلاب' : 'طالبات' }}</p>
                </div>
              
              </div>
              
              <!-- صف: السكن في الأعوام السابقة -->
              <div class="mb-4 row">
                <label class="col-sm-2 col-form-label fw-bold">السكن في الأعوام السابقة</label>
                <div class="col-sm-10">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.housingInPreviousYears || 'غير متوفر' }}</p>
                </div>
              </div>
              
            </div>
            <div *ngIf="!applicationRequest?.room">
              <p class="form-control-plaintext border-bottom border-light-subtle pb-1">غير متوفر</p>
            </div>
          </div>
          
          <!-- بيانات العائلة -->
          <div class="section-container mb-4">
            <h4 class="section-title border-bottom pb-2 mb-3">بيانات العائلة</h4>
            
            <!-- صف: بيانات الأب -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">اسم الأب</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.fatherName }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">الرقم القومي للأب</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.fatherNationalId }}</p>
              </div>
            </div>
            
            <!-- صف: وظيفة الأب ورقم هاتف الأب -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">وظيفة الأب</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.fatherOccupation }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">رقم هاتف الأب</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.fatherPhoneNumber }}</p>
              </div>
            </div>
            
            <!-- صف: بيانات ولي الأمر -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">اسم ولي الأمر</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.guardianName }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">الرقم القومي لولي الأمر</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.guardianNationalId }}</p>
              </div>
            </div>
            
            <!-- صف: رقم هاتف ولي الأمر -->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">رقم هاتف ولي الأمر</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.guardianPhoneNumber }}</p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">حالة الوالدين</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1"> {{ parentsStatusMap[applicationRequest?.parentsStatus] || 'غير محدد' }}</p>
              </div>
            </div>
            
            <!--صف: الأسرة بالخارج والاحتياجات الخاصة-->
            <div class="mb-4 row">
              <label class="col-sm-2 col-form-label fw-bold">الأسرة بالخارج</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext">
                  <span class="badge rounded-pill px-3 py-2 {{ applicationRequest?.familyAbroad ? 'bg-success' : 'bg-danger' }}">
                    {{ applicationRequest?.familyAbroad ? 'نعم' : 'لا' }}
                    <i class="fa-solid {{ applicationRequest?.familyAbroad ? 'fa-check' : 'fa-times' }} ms-1"></i>
                  </span>
                </p>
              </div>
              <label class="col-sm-2 col-form-label fw-bold">ذوي احتياجات خاصة</label>
              <div class="col-sm-4">
                <p class="form-control-plaintext">
                  <span class="badge rounded-pill px-3 py-2 {{ applicationRequest?.specialNeeds ? 'bg-success' : 'bg-danger' }}">
                    {{ applicationRequest?.specialNeeds ? 'نعم' : 'لا' }}
                    <i class="fa-solid {{ applicationRequest?.specialNeeds ? 'fa-check' : 'fa-times' }} ms-1"></i>
                  </span>
                </p>
              </div>
            </div>
          </div>
          
          <!-- معلومات دراسية إضافية -->
          <div class="section-container mb-4">
            <h4 class="section-title border-bottom pb-2 mb-3">المعلومات الدراسية</h4>
            
            @if (applicationRequest?.housingInPreviousYears) {
              <!-- طالب قديم - بيانات العام السابق -->
              <div class="mb-4 row">
                <label class="col-sm-2 col-form-label fw-bold">نسبة التقدير العام الماضي</label>
                <div class="col-sm-10">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.previousAcademicYearGpa }}</p>
                </div>
              </div>
            } @else {
              <!-- طالب مستجد - بيانات الثانوية العامة -->
              <div class="mb-4 row">
                <label class="col-sm-2 col-form-label fw-bold">شعبة الثانوية العامة</label>
                <div class="col-sm-4">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.secondaryDivision || 'غير متوفر' }}</p>
                </div>
                <label class="col-sm-2 col-form-label fw-bold">مجموع الثانوية العامة</label>
                <div class="col-sm-4">
                  <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.totalGradesHighSchool || 'غير متوفر' }}</p>
                </div>
              </div>
            }
          </div>
          
          <!-- معلومات أمنية وملاحظات -->
          <div class="section-container" *ngIf="_AuthService.getRole() !='USER'">
            <h4 class="section-title border-bottom pb-2 mb-3">معلومات إضافية</h4>
            
            <!-- صف: حالة الفحص الأمني -->
            <div class="mb-4 row" >
              <label class="col-sm-2 col-form-label fw-bold">حالة الفحص الأمني</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.securityCheckStatues || 'غير متوفر' }}</p>
              </div>
            </div>
            
            <!-- صف: الملاحظات -->
            <div class="mb-4 row" >
              <label class="col-sm-2 col-form-label fw-bold">ملاحظات الفحص الامني</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.notes || 'لا توجد ملاحظات' }}</p>
              </div>
            </div>
            <div class="mb-4 row" >
              <label class="col-sm-2 col-form-label fw-bold">ملاحظات حالة الطلب</label>
              <div class="col-sm-10">
                <p class="form-control-plaintext border-bottom border-light-subtle pb-1">{{ applicationRequest?.admissionRequestStatusNotes || 'لا توجد ملاحظات' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Buttons Section -->
     <div *ngIf="_AuthService.getRole() !='USER'">
    <div
     *appPrivileges="'ACCESS_UPDATE_ADMISSION_REQUEST_STATUS'"
      class="d-flex justify-content-center gap-3 mt-4 mb-4"
      >
      <button *ngIf="applicationRequest?.securityCheckStatues === 'ACCEPTED'" [class.d-none]="applicationRequest?.status === 'ACCEPTED'" (click)="confirmation(applicationRequest?.userId,'ACCEPTED',applicationRequest)" class="btn btn-success px-4 py-2">
        <i class="fa-solid fa-check me-2"></i> قبول الطلب
      </button>
      <button [class.d-none]="applicationRequest?.status === 'REJECTED'" (click)="confirmation(applicationRequest?.userId,'REJECTED',applicationRequest)" class="btn btn-danger px-4 py-2">
        <i class="fa-solid fa-times me-2"></i> رفض الطلب
      </button>
      <button [class.d-none]="applicationRequest?.status === 'UNDER_REVIEW'" (click)="confirmation(applicationRequest?.userId,'UNDER_REVIEW',applicationRequest)" class="btn btn-warning px-4 py-2">
        <i class="fa-solid fa-clock me-2"></i> تحت المراجعة
      </button>
    </div>
         </div>

  </section>
  }
</div>